/*! puppet-dom.js version: 2.4.0
 * (c) 2013 Joachim Wester
 * MIT license
 */
!function(a){var b=function(a){a||(a={});var b=a.callback;this.element=a.listenTo||document.body;var c=this.clickHandler.bind(this);this.historyHandler=this.historyHandler.bind(this),a.callback=function(a){this.listen(),b&&b.call(this,a)},this.listen=function(){this.listening=!0,this.element.addEventListener("click",c),window.addEventListener("popstate",this.historyHandler),this.element.addEventListener("puppet-redirect-pushstate",this.historyHandler)},this.unlisten=function(){this.listening=!1,this.element.removeEventListener("click",c),window.removeEventListener("popstate",this.historyHandler),this.element.removeEventListener("puppet-redirect-pushstate",this.historyHandler)},Puppet.call(this,a)};b.prototype=Object.create(Puppet.prototype),b.prototype.morphUrl=function(a){history.pushState(null,null,a),this.network.changeState(a)},b.prototype.clickHandler=function(a){if(!a.ctrlKey&&!a.metaKey&&2!=a.which){a.detail&&a.detail.target&&(a=a.detail);var c=a.target;if("A"!==c.nodeName)for(var d=0;d<a.path.length;d++)if("A"==a.path[d].nodeName){c=a.path[d];break}var e=c.href||c.getAttribute("href");e&&b.isApplicationLink(e)?(a.preventDefault(),a.stopPropagation(),this.morphUrl(e)):"submit"===c.type&&a.preventDefault()}},b.prototype.historyHandler=function(){this.network.changeState(location.href)},b.isApplicationLink=function(a){if("string"==typeof a){var b=document.createElement("A");b.href=a,""==b.host&&(b.href=b.href),a=b}return a.protocol==window.location.protocol&&a.host==window.location.host},a.PuppetDOM=b}(window);